<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tabloncito Digital - Admin / Inventario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="Icono.png">
    <link rel="shortcut icon" type="image/png" href="Icono.png">
    <link rel="apple-touch-icon" href="Icono.png">
    <!-- Preconnect para recursos externos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preload recursos cr√≠ticos -->
    <link rel="preload" href="estilos.css" as="style">
    <link rel="stylesheet" href="estilos.css">
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- jsPDF y html2canvas para generar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- JSON inline para carga instant√°nea (se actualiza autom√°ticamente) -->
    <script id="productos-iniciales-data" type="application/json">
    </script>
    <script id="servicios-iniciales-data" type="application/json">
    </script>
</head>
<body data-page="admin">

<header>
    <div class="header-inner">
        <div class="header-brand">
            <div class="logo-circle"><img src="Icono.png" alt="Tabloncito Digital" style="width:100%;height:100%;object-fit:contain;"></div>
            <div class="header-text">
                <h1>Tabloncito Digital</h1>
                <span>Panel de Inventario / Administraci√≥n</span>
            </div>
        </div>
        <div class="header-info">
            <div>
                <span class="badge">üîê Acceso solo administrador</span>
            </div>
            <div class="small">El Tabl√≥n de G√≥mez - Nari√±o</div>
        </div>
    </div>
</header>

<nav>
    <div class="nav-tabs">
        <a class="nav-link" href="tienda.html">
            <span class="icon">üõí</span> <span>Ir a Tienda</span>
        </a>
        <a class="nav-link" href="tecnologia.html">
            <span class="icon">üíª</span> <span>Tecnolog√≠a</span>
        </a>
        <a class="nav-link" href="servicios.html">
            <span class="icon">üìÑ</span> <span>Servicios</span>
        </a>
        <span class="nav-link active">
            <span class="icon">üì¶</span> <span>Inventario / Admin</span>
        </span>
    </div>
</nav>

<main>

    <!-- LOGIN ADMIN -->
    <section id="adminLoginSection">
        <div class="login-wrapper">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-avatar">üßë‚Äçüíº</div>
                    <div>
                        <div class="login-title">Acceso administrador</div>
                        <div class="login-sub">Esta secci√≥n es solo para ti</div>
                    </div>
                </div>
                <form id="adminLoginForm" class="login-body">
                    <label>Usuario</label>
                    <input type="text" id="adminUserInput" placeholder="admin">

                    <label>Contrase√±a</label>
                    <input type="password" id="adminPassInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">

                    <div id="adminLoginError" class="login-error"></div>

                    <div class="login-footer">
                        <button type="submit" class="btn btn-primary btn-sm">
                            üîê Entrar
                        </button>
                    </div>
                    <p class="text-muted small mt-5">
                        Usuario por defecto: <strong></strong> ‚Äì Contrase√±a: <strong></strong>.
                    </p>
                </form>
            </div>
        </div>
    </section>

    <!-- PANEL ADMIN -->
    <section id="adminPanel" style="display:none;">
        <div class="layout-admin">

            <!-- Columna izquierda -->
            <div>
                <!-- Buscar por c√≥digo -->
                <div class="card">
                    <h3>Buscar producto por c√≥digo (lector de barras)</h3>
                    <input type="text" id="buscarCodigo" placeholder="Escanee o escriba el c√≥digo del producto">
                    <p class="text-muted small">
                        El lector escribe el c√≥digo y env√≠a ENTER. Aqu√≠ se cargar√° el producto directo al formulario.
                    </p>
                </div>

                <!-- Formulario producto -->
                <div class="card" style="margin-top:12px;">
                    <h2><span class="icon">üõ†Ô∏è</span> Registrar / Editar producto</h2>
                    <form id="formProducto" class="form-grid">
                        <input type="hidden" id="productoId">

                        <div class="full">
                            <label>Nombre del producto *</label>
                            <input type="text" id="nombreProducto" required>
                        </div>

                        <div class="full">
                            <label>Descripci√≥n</label>
                            <textarea id="descripcionProducto" placeholder="Ej: Colecci√≥n de bol√≠grafos kawaii..."></textarea>
                        </div>

                        <div>
                            <label>Precio de llegada (costo) *</label>
                            <input type="number" id="costoProducto" min="0" step="50" required>
                        </div>

                        <div>
                            <label>Precio de venta por unidad *</label>
                            <input type="number" id="precioProducto" min="0" step="50" required>
                        </div>

                        <div>
                            <label>Precio anterior (tachado) opcional</label>
                            <input type="number" id="precioAnteriorProducto" min="0" step="50">
                        </div>

                        <div>
                            <label>Cantidad por pack (unidades)</label>
                            <input type="number" id="packCantidadProducto" min="0" step="1" placeholder="Ej: 6, 10, 12">
                        </div>

                        <div>
                            <label>Precio por pack</label>
                            <input type="number" id="packPrecioProducto" min="0" step="50" placeholder="Ej: 15000">
                        </div>

                        <div>
                            <label>Stock (unidades en inventario)</label>
                            <input type="number" id="stockProducto" min="0" step="1" required>
                        </div>

                        <div>
                            <label>Categor√≠a</label>
                            <input type="text" id="categoriaProducto" list="listaCategorias" placeholder="Ej: bol√≠grafos, l√°pices, regalos">
                            <datalist id="listaCategorias"></datalist>
                        </div>

                        <div class="full">
                            <label>C√≥digo / SKU (compatible con lector de barras)</label>
                            <input type="text" id="skuProducto" placeholder="Ej: 7701234567890">
                        </div>

                        <div class="full">
                            <label>URL imagen principal (opcional)</label>
                            <input type="text" id="imagenPrincipalProducto" placeholder="Ej: img/boligrafos1.jpg">
                            <div class="small text-muted mt-5">
                                Tambi√©n puedes subir una imagen desde tu computador:
                            </div>
                            <input type="file" id="imagenArchivoProducto" accept="image/*">
                        </div>

                        <div class="full">
                            <label>Im√°genes extra (URLs separadas por coma)</label>
                            <input type="text" id="imagenesExtraProducto" placeholder="Ej: img/boli1.jpg, img/boli2.jpg">
                        </div>

                        
<div class="full">
    <h3 style="margin-top:6px;">üé® Variantes (precio, imagen y stock)</h3>
    <p class="text-muted small">
        Agrega colores/dise√±os/tama√±os. Cada variante puede tener <strong>precio propio</strong>, <strong>imagen</strong> y <strong>stock</strong>.
        Si dejas el precio en 0, usar√° el precio general del producto.
    </p>

    <div id="variantesEditor" class="variantes-editor"></div>

    <div class="mt-5" style="display:flex; gap:8px; flex-wrap:wrap;">
        <button type="button" class="btn btn-secondary btn-sm" id="btnAddVariante">‚ûï Agregar variante</button>
        <button type="button" class="btn btn-secondary btn-sm" id="btnAutoVarDesdeTexto">ü™Ñ Convertir texto ‚Äúrojo, azul‚Äù</button>
        <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarVariantes">üßπ Limpiar variantes</button>
    </div>

    <!-- Se guarda como JSON para compatibilidad -->
    <textarea id="variantesProducto" style="display:none;"></textarea>
</div>


                        <div class="full">
                            <label>
                                <input type="checkbox" id="promoActivaProducto">
                                Activar promoci√≥n para este producto
                            </label>
                        </div>

                        <div>
                            <label>Texto promo (Ej: √öLTIMO D√çA, 12.12)</label>
                            <input type="text" id="promoTextoProducto">
                        </div>

                        <div>
                            <label>Precio promocional</label>
                            <input type="number" id="precioPromoProducto" min="0" step="50">
                        </div>

                        <div class="full">
                            <label>Etiqueta verde (Ej: M√°s vendidos, TOP ventas)</label>
                            <input type="text" id="etiquetaVerdeProducto" list="listaEtiquetasVerdes">
                            <datalist id="listaEtiquetasVerdes">
                                <option value="M√°s vendidos"></option>
                                <option value="TOP ventas"></option>
                                <option value="Nuevo"></option>
                                <option value="Favorito de clientes"></option>
                                <option value="Edici√≥n limitada"></option>
                                <option value="S√∫per promo"></option>
                            </datalist>
                        </div>

                        <div class="full mt-5">
                            <button type="submit" class="btn btn-primary btn-full" id="btnGuardarProducto">
                                üíæ Guardar producto
                            </button>
                        </div>

                        <div class="full">
                            <button type="button" class="btn btn-secondary btn-full mt-5" id="btnLimpiarFormulario">
                                üßΩ Limpiar formulario
                            </button>
                        </div>
                    </form>
                </div>

            </div>

            <!-- Tabla inventario -->
            <div>
                <div class="card">
                    <div class="admin-tabs">
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn active" data-admin-tab="inventario">
                            üìã Inventario
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="ventas">
                            üìà Ventas
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="bajo-stock">
                            ‚ö†Ô∏è Bajo stock
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="creditos">
                            üí≥ Cr√©ditos
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="tareas">
                            üìã Tareas
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="servicios">
                            üìÑ Servicios
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="analisis">
                            üìä An√°lisis
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm admin-tab-btn" data-admin-tab="herramientas">
                            üß† Herramientas
                        </button>
                    </div>

                    <!-- TAB: Inventario -->
                    <div class="admin-tab-content" data-admin-tab-content="inventario">
                        <h2><span class="icon">üìã</span> Productos en inventario</h2>
                        <p class="text-muted small">
                            Usa ‚úè para editar y üóë para eliminar.  
                            Tambi√©n puedes escanear un c√≥digo o buscar por nombre para abrir un producto.
                        </p>
                        <div class="mt-5" style="display:flex; gap:8px; flex-wrap:wrap; align-items:flex-end;">
                            <div style="flex:1 1 220px;">
                                <label>Buscar por nombre</label>
                                <input type="text" id="buscarNombreInventario" placeholder="Escribe parte del nombre del producto">
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarBusquedaNombre">
                                Limpiar
                            </button>
                        </div>
                        <div class="table-wrapper mt-8">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Categor√≠a</th>
                                        <th class="text-right">Costo</th>
                                        <th class="text-right">Venta unidad</th>
                                        <th class="text-right">Pack</th>
                                        <th class="text-right">Stock</th>
                                        <th>C√≥digo</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaInventario">
                                </tbody>
                            </table>
                        </div>

                        <p id="inventarioVacio" class="text-muted small mt-5" style="display:none;">
                            A√∫n no hay productos registrados.
                        </p>
                    </div>

                    <!-- TAB: Ventas -->
                    <div class="admin-tab-content" data-admin-tab-content="ventas" style="display:none;">
                        <h2><span class="icon">üìà</span> Historial de ventas &amp; reportes</h2>
                    <p class="text-muted small">
                        Aqu√≠ ver√°s las <strong>ventas f√≠sicas</strong> registradas y los <strong>pedidos por WhatsApp</strong> generados desde la Tienda.
                    </p>

                    <div class="dashboard-strip mt-5">
                        <div class="dash-card">
                            <div class="dash-icon">üìÜ</div>
                            <div>
                                <div class="dash-label">Rango</div>
                                <div class="dash-value" id="ventasRangoLabel">Hoy</div>
                            </div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-icon">üßæ</div>
                            <div>
                                <div class="dash-label">N¬∞ registros</div>
                                <div class="dash-value" id="ventasCantidad">0</div>
                            </div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-icon">üíµ</div>
                            <div>
                                <div class="dash-label">Total vendido</div>
                                <div class="dash-value" id="ventasTotal">$0</div>
                            </div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-icon">üí∞</div>
                            <div>
                                <div class="dash-label">Ganancia diaria</div>
                                <div class="dash-value" id="ventasGanancia">$0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°ficos de ventas -->
                    <div class="mt-5" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;">
                        <div class="card" style="padding:20px;">
                            <h4 style="font-size:0.95rem;margin-bottom:15px;">üìà Ventas por D√≠a (√öltimos 7 d√≠as)</h4>
                            <canvas id="graficoVentasDiaVentas" style="max-height:250px;"></canvas>
                        </div>
                        <div class="card" style="padding:20px;">
                            <h4 style="font-size:0.95rem;margin-bottom:15px;">üìä Ventas por Tipo</h4>
                            <canvas id="graficoVentasTipoVentas" style="max-height:250px;"></canvas>
                        </div>
                    </div>

                    <!-- SECCI√ìN DE DINERO PROPIO -->
                    <div class="mt-5" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);padding:25px;border-radius:10px;border:2px solid #5a67d8;box-shadow:0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                            <h3 style="margin:0;display:flex;align-items:center;gap:10px;color:white;">
                                <span style="font-size:28px;">üíé</span>
                                <span>Dinero Propio</span>
                            </h3>
                            <button type="button" class="btn btn-light btn-sm" id="btnEditarDineroPropio" style="font-weight:bold;">
                                ‚úèÔ∏è Editar
                            </button>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:15px;margin-bottom:20px;">
                            <div style="background:rgba(255,255,255,0.95);padding:18px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                                <div style="font-size:13px;color:#666;margin-bottom:6px;font-weight:600;">üí≥ Dinero Propio Nequi</div>
                                <div style="font-size:28px;font-weight:bold;color:#28a745;" id="dineroPropioNequi">$0</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.95);padding:18px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                                <div style="font-size:13px;color:#666;margin-bottom:6px;font-weight:600;">üíµ Dinero Propio F√≠sico</div>
                                <div style="font-size:28px;font-weight:bold;color:#007bff;" id="dineroPropioFisico">$0</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.95);padding:18px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);border:2px solid #28a745;">
                                <div style="font-size:13px;color:#666;margin-bottom:6px;font-weight:600;">üí∞ Total Nequi</div>
                                <div style="font-size:28px;font-weight:bold;color:#28a745;" id="totalNequi">$0</div>
                                <div style="font-size:11px;color:#999;margin-top:4px;">Propio + Negocio</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.95);padding:18px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);border:2px solid #007bff;">
                                <div style="font-size:13px;color:#666;margin-bottom:6px;font-weight:600;">üí∞ Total F√≠sico</div>
                                <div style="font-size:28px;font-weight:bold;color:#007bff;" id="totalFisico">$0</div>
                                <div style="font-size:11px;color:#999;margin-top:4px;">Propio + Negocio</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.95);padding:18px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);border:3px solid #ffd700;">
                                <div style="font-size:13px;color:#666;margin-bottom:6px;font-weight:600;">üíé Total Dinero Propio</div>
                                <div style="font-size:32px;font-weight:bold;color:#ff6b35;" id="dineroPropioTotal">$0</div>
                            </div>
                        </div>
                        <p style="margin-top:0;margin-bottom:0;color:rgba(255,255,255,0.9);font-size:13px;text-align:center;">
                            üí° Tu dinero personal (independiente del negocio)
                        </p>
                    </div>

                    <!-- SECCI√ìN DE PAGAR SERVICIO -->
                    <div class="mt-5" style="background:#e8f5e9;padding:20px;border-radius:8px;border:2px solid #4caf50;">
                        <h3 style="margin-top:0;margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                            <span>üí≥</span> Pagar Servicio
                        </h3>
                        <p class="text-muted small" style="margin-bottom:15px;">
                            Registra el pago de un servicio y elige de d√≥nde descontar el dinero. Si pagas con dinero del negocio, se registrar√° como pr√©stamo propio.
                        </p>
                        <form id="formPagarServicio" style="display:grid;grid-template-columns:2fr 1fr auto;gap:10px;align-items:end;">
                            <div>
                                <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Nombre del Servicio *</label>
                                <input type="text" id="servicioNombre" required placeholder="Ej: Internet, Luz, Agua, etc." style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Valor *</label>
                                <input type="number" id="servicioValor" required min="1" step="100" placeholder="0" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                            </div>
                            <div>
                                <button type="submit" class="btn btn-success btn-sm" style="height:38px;">
                                    üí≥ Pagar Servicio
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- SECCI√ìN DE PRESUPUESTO -->
                    <div class="mt-5" style="background:#f8f9fa;padding:20px;border-radius:8px;border:2px solid #e0e0e0;">
                        <h3 style="margin-top:0;margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                            <span>üí∞</span> Presupuesto del Negocio
                        </h3>
                        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:15px;margin-bottom:15px;">
                            <div style="background:white;padding:15px;border-radius:6px;border-left:4px solid #28a745;">
                                <div style="font-size:12px;color:#666;margin-bottom:5px;">üí≥ Dinero en Nequi</div>
                                <div style="font-size:24px;font-weight:bold;color:#28a745;" id="presupuestoNequi">$0</div>
                            </div>
                            <div style="background:white;padding:15px;border-radius:6px;border-left:4px solid #007bff;">
                                <div style="font-size:12px;color:#666;margin-bottom:5px;">üíµ Dinero F√≠sico</div>
                                <div style="font-size:24px;font-weight:bold;color:#007bff;" id="presupuestoFisico">$0</div>
                            </div>
                            <div style="background:white;padding:15px;border-radius:6px;border-left:4px solid #17a2b8;">
                                <div style="font-size:12px;color:#666;margin-bottom:5px;">üìä Total Disponible</div>
                                <div style="font-size:24px;font-weight:bold;color:#17a2b8;" id="presupuestoTotal">$0</div>
                            </div>
                            <div style="background:white;padding:15px;border-radius:6px;border-left:4px solid #dc3545;">
                                <div style="font-size:12px;color:#666;margin-bottom:5px;">üìâ Pr√©stamos Propios</div>
                                <div style="font-size:24px;font-weight:bold;color:#dc3545;" id="presupuestoDeuda">$0</div>
                            </div>
                        </div>
                        <div style="display:flex;gap:8px;flex-wrap:wrap;">
                            <button type="button" class="btn btn-primary btn-sm" id="btnEditarPresupuesto">
                                ‚úèÔ∏è Editar Presupuesto
                            </button>
                            <button type="button" class="btn btn-warning btn-sm" id="btnAgregarPrestamoPropio">
                                ‚ûï Agregar Pr√©stamo Propio
                            </button>
                            <button type="button" class="btn btn-info btn-sm" id="btnVerHistorialPrestamos">
                                üìã Ver Historial de Pr√©stamos
                            </button>
                            <button type="button" class="btn btn-success btn-sm" id="btnImportarPresupuesto" title="Importar presupuesto desde archivo de respaldo">
                                ‚¨Ü Importar Presupuesto
                            </button>
                            <button type="button" class="btn btn-success btn-sm" id="btnExportarPresupuesto" title="Exportar presupuesto a archivo JSON">
                                ‚¨á Exportar Presupuesto
                            </button>
                            <button type="button" class="btn btn-info btn-sm" id="btnConfigurarRespaldoPresupuesto" title="Configurar respaldo autom√°tico del presupuesto">
                                üíæ Configurar Respaldo Autom√°tico
                            </button>
                        </div>
                    </div>

                    <div class="mt-5" style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;">
                        <button type="button" class="btn btn-secondary btn-sm" id="btnVentasHoy">Hoy</button>
                        <button type="button" class="btn btn-secondary btn-sm" id="btnVentas7Dias">√öltimos 7 d√≠as</button>
                        <button type="button" class="btn btn-secondary btn-sm" id="btnVentasTodo">Todo el historial</button>
                        
                        <div style="display:flex;gap:6px;align-items:center;margin-left:10px;padding:6px;background:#f5f5f5;border-radius:4px;">
                            <label style="font-size:12px;font-weight:bold;margin-right:4px;">üìÖ D√≠a:</label>
                            <input type="date" id="inputFechaVentas" style="padding:4px 8px;border:1px solid #ddd;border-radius:4px;font-size:12px;">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnVentasPorFecha" style="margin-left:4px;">Ver d√≠a</button>
                        </div>
                        
                        <div style="display:flex;gap:6px;align-items:center;padding:6px;background:#f5f5f5;border-radius:4px;">
                            <label style="font-size:12px;font-weight:bold;margin-right:4px;">üìÜ Mes:</label>
                            <input type="month" id="inputMesVentas" style="padding:4px 8px;border:1px solid #ddd;border-radius:4px;font-size:12px;">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnVentasPorMes" style="margin-left:4px;">Ver mes</button>
                        </div>
                        
                        <div style="display:flex;gap:6px;align-items:center;padding:6px;background:#f5f5f5;border-radius:4px;">
                            <label style="font-size:12px;font-weight:bold;margin-right:4px;">üìÖ A√±o:</label>
                            <input type="number" id="inputAnioVentas" min="2020" max="2100" value="" placeholder="2024" style="padding:4px 8px;border:1px solid #ddd;border-radius:4px;font-size:12px;width:80px;">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnVentasPorAnio" style="margin-left:4px;">Ver a√±o</button>
                        </div>
                        
                        <div style="margin-left:auto; display:flex; gap:6px;">
                            <button type="button" class="btn btn-primary btn-sm" id="btnConfigurarGuardadoVentas" title="Configurar guardado autom√°tico de ventas en archivo">
                                üíæ Guardado autom√°tico
                            </button>
                            <button type="button" class="btn btn-success btn-sm" id="btnImportarVentas" title="Importar ventas desde archivo de respaldo">
                                ‚¨Ü Importar ventas
                            </button>
                            <button type="button" class="btn btn-warning btn-sm" id="btnRecuperarVentasPerdidas" title="Recuperar ventas perdidas bas√°ndose en los contadores de productos">
                                üîÑ Recuperar ventas perdidas
                            </button>
                            <button type="button" class="btn btn-info btn-sm" id="btnDescargarReporteMensual" title="Descargar reporte mensual detallado">
                                üìä Reporte Mensual
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnExportarVentas">
                                ‚¨á Exportar ventas (JSON)
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" id="btnBorrarHistorialVentas">
                                üóëÔ∏è Borrar historial
                            </button>
                        </div>
                    </div>

                    <div class="table-wrapper mt-8">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha / hora</th>
                                    <th>Tipo</th>
                                    <th>Detalle</th>
                                    <th class="text-right">Total</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaVentas">
                            </tbody>
                        </table>
                    </div>

                    <p id="ventasVacio" class="text-muted small mt-5" style="display:none;">
                        A√∫n no hay ventas registradas.
                    </p>
                    </div>

                    <!-- TAB: Bajo stock -->
                    <div class="admin-tab-content" data-admin-tab-content="bajo-stock" style="display:none;">
                        <h2><span class="icon">‚ö†Ô∏è</span> Productos con poco stock</h2>
                    <p class="text-muted small">
                        Ayuda para tus <strong>pedidos a proveedores</strong>. Ajusta el umbral de alerta a tu gusto.
                    </p>
                    <div class="mt-5" style="display:flex;align-items:flex-start;gap:8px;flex-wrap:wrap;">
                        <div style="display:flex;align-items:center;gap:8px;">
                            <label class="small">Umbral (unidades &le;):</label>
                            <input type="number" id="umbralBajoStock" min="1" value="5" style="width:80px;padding:4px;">
                        </div>
                        <div style="display:flex;flex-direction:column;gap:4px;padding:8px;background:#fff;border:1px solid #ddd;border-radius:4px;min-width:200px;max-width:400px;">
                            <label class="small" style="font-weight:bold;margin-bottom:4px;">Categor√≠as:</label>
                            <div id="filtroCategoriasBajoStock" style="display:flex;flex-direction:column;gap:4px;max-height:150px;overflow-y:auto;">
                                <!-- Los checkboxes se generar√°n din√°micamente -->
                            </div>
                            <div style="display:flex;gap:4px;margin-top:4px;">
                                <button type="button" class="btn btn-secondary btn-sm" id="btnSeleccionarTodasCategorias" style="padding:2px 8px;font-size:11px;">‚úì Todas</button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btnDeseleccionarTodasCategorias" style="padding:2px 8px;font-size:11px;">‚úñ Ninguna</button>
                            </div>
                        </div>
                        <div style="display:flex;align-items:center;gap:6px;padding:4px 8px;background:#fff;border:1px solid #ddd;border-radius:4px;">
                            <label class="small" style="margin:0;">üîç Buscar:</label>
                            <input type="text" id="buscarBajoStock" placeholder="Nombre del producto..." style="border:none;outline:none;padding:2px 4px;min-width:200px;">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarBusquedaBajoStock" style="padding:2px 8px;font-size:11px;">‚úñ</button>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" id="btnAplicarUmbralBajoStock">Actualizar</button>
                        <button type="button" class="btn btn-warning btn-sm" id="btnLimpiarCantidadesBajoStock" title="Limpiar todas las cantidades a pedir">
                            üßπ Limpiar Cantidades
                        </button>
                        <div style="margin-left:auto;display:flex;gap:6px;">
                            <button type="button" class="btn btn-success btn-sm" id="btnWhatsAppBajoStock">
                                üì± Enviar pedido por WhatsApp
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnExportarBajoStock">
                                ‚¨á Exportar bajo stock (CSV)
                            </button>
                        </div>
                    </div>
                    <div class="mt-5" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;background:#f5f5f5;padding:10px;border-radius:4px;">
                        <label class="small" style="font-weight:bold;">Stock objetivo (cantidad deseada por producto):</label>
                        <input type="number" id="stockObjetivoBajoStock" min="1" value="10" style="width:80px;padding:4px;">
                        <button type="button" class="btn btn-primary btn-sm" id="btnAplicarStockObjetivo" style="padding:4px 12px;">
                            ‚úÖ Aplicar
                        </button>
                        <span class="text-muted small">(Calcula cu√°ntas unidades faltan para llegar al stock objetivo y las aplica a los productos seleccionados)</span>
                        <div style="margin-left:auto;padding:8px 12px;background:#fff;border-radius:4px;border:2px solid #28a745;">
                            <span class="small" style="font-weight:bold;color:#666;">üí∞ Costo estimado del pedido:</span>
                            <span id="costoEstimadoPedido" style="font-size:18px;font-weight:bold;color:#28a745;margin-left:8px;">$0</span>
                        </div>
                    </div>
                    <div class="table-wrapper mt-8">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:40px;">
                                        <input type="checkbox" id="checkTodosBajoStock" title="Seleccionar todos">
                                    </th>
                                    <th id="thOrdenarNombre" style="cursor:pointer;user-select:none;" title="Clic para ordenar por nombre">
                                        Producto <span id="iconOrdenNombre" style="font-size:10px;">‚áÖ</span>
                                    </th>
                                    <th>Categor√≠a</th>
                                    <th id="thOrdenarStock" class="text-right" style="cursor:pointer;user-select:none;" title="Clic para ordenar por stock">
                                        Stock <span id="iconOrdenStock" style="font-size:10px;">‚áÖ</span>
                                    </th>
                                    <th class="text-center">Cantidad a Pedir</th>
                                </tr>
                            </thead>
                            <tbody id="tablaBajoInventario">
                            </tbody>
                        </table>
                    </div>
                    <p id="bajoInventarioVacio" class="text-muted small mt-5" style="display:none;">
                        No hay productos con poco stock. üíú
                    </p>
                    
                    <!-- SECCI√ìN DE PEDIDOS PENDIENTES -->
                    <div class="mt-8" style="background:#fff3cd;padding:20px;border-radius:8px;border:2px solid #ffc107;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                            <h3 style="margin:0;display:flex;align-items:center;gap:8px;">
                                <span>üì¶</span> Pedidos Pendientes de Confirmar
                            </h3>
                            <div style="display:flex;gap:8px;">
                                <button type="button" class="btn btn-secondary btn-sm" id="btnExportarPedidosPendientes" title="Exportar pedidos pendientes a archivo JSON">
                                    ‚¨á Exportar Pedidos Pendientes
                                </button>
                                <button type="button" class="btn btn-success btn-sm" id="btnImportarPedidosPendientes" title="Importar pedidos pendientes desde archivo JSON">
                                    ‚¨Ü Importar Pedidos Pendientes
                                </button>
                            </div>
                        </div>
                        <p class="text-muted small" style="margin-bottom:15px;">
                            Cuando recibas productos de un pedido, confirma cada producto individualmente para agregarlo al stock y descontar del presupuesto.
                        </p>
                        <div style="display:flex;gap:8px;margin-bottom:15px;flex-wrap:wrap;">
                            <button type="button" class="btn btn-success btn-sm" id="btnConfirmarTodoPedidos" title="Confirmar todos los productos pendientes">
                                ‚úÖ Confirmar Todo
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" id="btnEliminarTodoPedidos" title="Eliminar todos los productos pendientes">
                                üóëÔ∏è Eliminar Todo
                            </button>
                        </div>
                        <div id="pedidosPendientesContainer">
                            <p class="text-muted small" id="sinPedidosPendientes">No hay pedidos pendientes de confirmar.</p>
                        </div>
                    </div>
                    
                    <!-- SECCI√ìN DE HISTORIAL DE PEDIDOS -->
                    <div class="mt-8" style="background:#e7f3ff;padding:20px;border-radius:8px;border:2px solid #0066cc;">
                        <h3 style="margin-top:0;margin-bottom:15px;display:flex;align-items:center;gap:8px;">
                            <span>üìã</span> Historial de Pedidos
                        </h3>
                        <p class="text-muted small" style="margin-bottom:15px;">
                            Registro de productos confirmados y eliminados de pedidos. Los productos confirmados se agregaron al stock y los eliminados fueron removidos del pedido.
                        </p>
                        <div id="historialPedidosContainer">
                            <p class="text-muted small" id="sinHistorialPedidos">No hay registros en el historial de pedidos.</p>
                        </div>
                    </div>
                    </div>

                    <!-- TAB: Cr√©ditos -->
                    <div class="admin-tab-content" data-admin-tab-content="creditos" style="display:none;">
                        <h2><span class="icon">üí≥</span> Gesti√≥n de Cr√©ditos</h2>
                        <p class="text-muted small">
                            Registra y gestiona los cr√©ditos que has otorgado a tus clientes.
                        </p>

                        <!-- Formulario para agregar cr√©dito -->
                        <div class="card mt-5" style="background:#f9f9f9;">
                            <h3 style="font-size:1rem;margin-bottom:15px;">‚ûï Agregar Nuevo Cr√©dito</h3>
                            <form id="formCredito" style="display:grid;gap:12px;">
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Nombre del Cliente *</label>
                                        <input type="text" id="creditoCliente" required placeholder="Ej: Juan P√©rez" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Tel√©fono</label>
                                        <input type="tel" id="creditoTelefono" placeholder="Ej: 3001234567" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                    </div>
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Buscar Producto o Servicio *</label>
                                    <div style="position:relative;">
                                        <input type="text" id="creditoBuscarProducto" placeholder="Buscar producto o servicio..." style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;" autocomplete="off">
                                        <div id="creditoProductosLista" style="display:none;position:absolute;top:100%;left:0;right:0;background:white;border:1px solid #ddd;border-radius:4px;max-height:300px;overflow-y:auto;z-index:1000;box-shadow:0 4px 6px rgba(0,0,0,0.1);margin-top:4px;"></div>
                                    </div>
                                </div>
                                <div style="padding:12px;background:#e7f3ff;border:1px solid #b3d9ff;border-radius:4px;margin-top:8px;">
                                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                        <label style="font-size:0.9rem;font-weight:bold;color:#0066cc;">‚ûï Crear Servicio Personalizado</label>
                                        <button type="button" id="btnAgregarServicioPersonalizado" class="btn btn-secondary btn-sm" style="padding:4px 12px;font-size:0.85rem;">Mostrar</button>
                                    </div>
                                    <div id="creditoServicioPersonalizado" style="display:none;">
                                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
                                            <div>
                                                <label style="display:block;margin-bottom:4px;font-size:0.8rem;font-weight:bold;">Nombre del Servicio</label>
                                                <input type="text" id="creditoServicioPersonalizadoNombre" placeholder="Ej: Reparaci√≥n de computadora" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:0.85rem;">
                                            </div>
                                            <div>
                                                <label style="display:block;margin-bottom:4px;font-size:0.8rem;font-weight:bold;">Precio</label>
                                                <input type="number" id="creditoServicioPersonalizadoPrecio" min="0" step="0.01" placeholder="0" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:0.85rem;">
                                            </div>
                                        </div>
                                        <button type="button" id="btnConfirmarServicioPersonalizado" class="btn btn-primary btn-sm" style="width:100%;padding:6px;font-size:0.85rem;">‚ûï Agregar Servicio</button>
                                    </div>
                                </div>
                                <div id="creditoItemsAgregados" style="display:none;margin-top:8px;">
                                    <label style="display:block;margin-bottom:8px;font-size:0.85rem;font-weight:bold;">Items agregados:</label>
                                    <div id="creditoItemsLista" style="display:flex;flex-direction:column;gap:8px;"></div>
                                </div>
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Monto Total del Cr√©dito *</label>
                                        <input type="number" id="creditoMonto" required min="0" step="0.01" placeholder="0" readonly style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;background:#f5f5f5;font-weight:bold;">
                                    </div>
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Fecha</label>
                                        <input type="date" id="creditoFecha" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                    </div>
                                </div>
                                <div id="creditoModoEdicion" style="display:none;padding:12px;background:#fff3cd;border:1px solid #ffc107;border-radius:4px;">
                                    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                        <input type="checkbox" id="creditoAgregarAlExistente" style="width:18px;height:18px;">
                                        <span style="font-size:0.9rem;font-weight:bold;">‚ûï Agregar al cr√©dito existente (sumar al monto actual)</span>
                                    </label>
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Notas (opcional)</label>
                                    <textarea id="creditoNotas" rows="2" placeholder="Informaci√≥n adicional..." style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;resize:vertical;"></textarea>
                                </div>
                                <div style="display:flex;gap:8px;">
                                    <button type="submit" class="btn btn-primary btn-sm">üíæ Guardar Cr√©dito</button>
                                    <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarFormCredito">üßΩ Limpiar</button>
                                </div>
                            </form>
                        </div>

                        <!-- Filtros y estad√≠sticas -->
                        <div class="dashboard-strip mt-5">
                            <div class="dash-card">
                                <div class="dash-icon">üí≥</div>
                                <div>
                                    <div class="dash-label">Total Cr√©ditos</div>
                                    <div class="dash-value" id="creditosTotal">0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">üí∞</div>
                                <div>
                                    <div class="dash-label">Monto Pendiente</div>
                                    <div class="dash-value" id="creditosPendiente">$0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">‚úÖ</div>
                                <div>
                                    <div class="dash-label">Monto Pagado</div>
                                    <div class="dash-value" id="creditosPagado">$0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Filtros y acciones -->
                        <div class="mt-5" style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnCreditosTodos">Todos</button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnCreditosPendientes">Pendientes</button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnCreditosPagados">Pagados</button>
                            <input type="text" id="filtroCreditosBusqueda" placeholder="Buscar por cliente o producto..." style="padding:6px 12px;border:1px solid #ddd;border-radius:4px;flex:1;min-width:200px;">
                            <div style="margin-left:auto;display:flex;gap:6px;">
                                <button type="button" class="btn btn-primary btn-sm" id="btnConfigurarGuardadoCreditos" title="Configurar guardado autom√°tico de cr√©ditos en archivo">
                                    üíæ Guardado autom√°tico
                                </button>
                                <button type="button" class="btn btn-success btn-sm" id="btnImportarCreditos" title="Importar cr√©ditos desde archivo de respaldo">
                                    ‚¨Ü Importar
                                </button>
                                <button type="button" class="btn btn-success btn-sm" id="btnExportarCreditos">‚¨á Exportar</button>
                            </div>
                        </div>

                        <!-- Tabla de cr√©ditos -->
                        <div class="table-wrapper mt-8">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Tel√©fono</th>
                                        <th>Producto/Servicio</th>
                                        <th class="text-right">Monto</th>
                                        <th class="text-center">Estado</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaCreditos">
                                </tbody>
                            </table>
                        </div>

                        <p id="creditosVacio" class="text-muted small mt-5" style="display:none;">
                            No hay cr√©ditos registrados.
                        </p>
                    </div>

                    <!-- TAB: Tareas -->
                    <div class="admin-tab-content" data-admin-tab-content="tareas" style="display:none;">
                        <h2><span class="icon">üìã</span> Agenda de Tareas</h2>
                        <p class="text-muted small">
                            Organiza y gestiona tus tareas pendientes con recordatorios en tiempo real.
                        </p>

                        <!-- Formulario para agregar tarea -->
                        <div class="card mt-5" style="background:#f9f9f9;">
                            <h3 style="font-size:1rem;margin-bottom:15px;">‚ûï Agregar Nueva Tarea</h3>
                            <form id="formTarea" style="display:grid;gap:12px;">
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Nombre de la Tarea *</label>
                                        <input type="text" id="tareaNombre" required placeholder="Ej: Entregar pedido a cliente" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Fecha y Hora de Entrega *</label>
                                        <input type="datetime-local" id="tareaFechaEntrega" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                    </div>
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Descripci√≥n</label>
                                    <textarea id="tareaDescripcion" rows="3" placeholder="Detalles de la tarea..." style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;resize:vertical;"></textarea>
                                </div>
                                <div style="display:flex;gap:8px;align-items:center;">
                                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
                                        <input type="checkbox" id="tareaPagada" style="width:18px;height:18px;">
                                        <span style="font-size:0.85rem;">Marcar como pagada</span>
                                    </label>
                                </div>
                                <div style="display:flex;gap:8px;">
                                    <button type="submit" class="btn btn-primary btn-sm">üíæ Guardar Tarea</button>
                                    <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarFormTarea">üßΩ Limpiar</button>
                                </div>
                            </form>
                        </div>

                        <!-- Estad√≠sticas -->
                        <div class="dashboard-strip mt-5">
                            <div class="dash-card">
                                <div class="dash-icon">üìã</div>
                                <div>
                                    <div class="dash-label">Total Tareas</div>
                                    <div class="dash-value" id="tareasTotal">0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">‚è∞</div>
                                <div>
                                    <div class="dash-label">Pendientes</div>
                                    <div class="dash-value" id="tareasPendientes">0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">‚úÖ</div>
                                <div>
                                    <div class="dash-label">Completadas</div>
                                    <div class="dash-value" id="tareasCompletadas">0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">üí∞</div>
                                <div>
                                    <div class="dash-label">Pagadas</div>
                                    <div class="dash-value" id="tareasPagadas">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="mt-5" style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnTareasTodas">Todas</button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnTareasPendientes">Pendientes</button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnTareasCompletadas">Completadas</button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnTareasPagadas">Pagadas</button>
                            <input type="text" id="filtroTareasBusqueda" placeholder="Buscar tarea..." style="padding:6px 12px;border:1px solid #ddd;border-radius:4px;flex:1;min-width:200px;">
                            <div style="margin-left:auto;display:flex;gap:6px;">
                                <button type="button" class="btn btn-primary btn-sm" id="btnConfigurarGuardadoTareas" title="Configurar guardado autom√°tico de tareas en archivo">
                                    üíæ Guardado autom√°tico
                                </button>
                                <button type="button" class="btn btn-success btn-sm" id="btnImportarTareas" title="Importar tareas desde archivo de respaldo">
                                    ‚¨Ü Importar
                                </button>
                                <button type="button" class="btn btn-success btn-sm" id="btnExportarTareas">‚¨á Exportar</button>
                            </div>
                        </div>

                        <!-- Tabla de tareas -->
                        <div class="table-wrapper mt-8">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tarea</th>
                                        <th>Descripci√≥n</th>
                                        <th>Fecha/Hora Entrega</th>
                                        <th class="text-center">Tiempo Restante</th>
                                        <th class="text-center">Estado</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaTareas">
                                </tbody>
                            </table>
                        </div>

                        <p id="tareasVacio" class="text-muted small mt-5" style="display:none;">
                            No hay tareas registradas.
                        </p>
                    </div>

                    <!-- TAB: Servicios -->
                    <div class="admin-tab-content" data-admin-tab-content="servicios" style="display:none;">
                        <h2><span class="icon">üìÑ</span> Gesti√≥n de Servicios de Papeler√≠a</h2>
                        <p class="text-muted small">
                            Administra los servicios que ofreces (impresiones, fotocopias, etc.)
                        </p>

                        <!-- Formulario para agregar servicio -->
                        <div class="card mt-5" style="background:#f9f9f9;">
                            <h3 style="font-size:1rem;margin-bottom:15px;">‚ûï Agregar Nuevo Servicio</h3>
                            <form id="formServicio" style="display:grid;gap:12px;">
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Nombre del Servicio *</label>
                                    <input type="text" id="servicioNombre" required placeholder="Ej: Impresi√≥n de fotos" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Descripci√≥n *</label>
                                    <textarea id="servicioDescripcion" required rows="3" placeholder="Describe el servicio que ofreces..." style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;resize:vertical;"></textarea>
                                </div>
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Precio Base *</label>
                                        <input type="number" id="servicioPrecio" required min="0" step="0.01" placeholder="0" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                        <p class="text-muted small" style="margin-top:4px;font-size:0.75rem;">Precio base del servicio (si no hay variantes)</p>
                                    </div>
                                    <div>
                                        <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Imagen (URL)</label>
                                        <input type="text" id="servicioImagen" placeholder="URL de la imagen o ruta local" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                    </div>
                                </div>
                                <div class="full" style="margin-top:12px;">
                                    <h3 style="margin-top:6px;font-size:0.95rem;">üé® Variantes (Opcional)</h3>
                                    <p class="text-muted small">
                                        Agrega opciones del servicio (tama√±os, tipos, etc.). Cada variante puede tener <strong>precio propio</strong>, <strong>imagen</strong> y <strong>SKU</strong>.
                                        Si dejas el precio en 0, usar√° el precio base del servicio.
                                    </p>

                                    <div id="variantesEditorServicio" class="variantes-editor"></div>

                                    <div class="mt-5" style="display:flex; gap:8px; flex-wrap:wrap;">
                                        <button type="button" class="btn btn-secondary btn-sm" id="btnAddVarianteServicio">‚ûï Agregar variante</button>
                                        <button type="button" class="btn btn-secondary btn-sm" id="btnAutoVarDesdeTextoServicio">ü™Ñ Convertir texto "peque√±o, grande"</button>
                                        <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarVariantesServicio">üßπ Limpiar variantes</button>
                                    </div>

                                    <!-- Se guarda como JSON para compatibilidad -->
                                    <textarea id="servicioVariantes" style="display:none;"></textarea>
                                </div>
                                <div style="display:flex;gap:8px;">
                                    <button type="submit" class="btn btn-primary btn-sm">üíæ Guardar Servicio</button>
                                    <button type="button" class="btn btn-secondary btn-sm" id="btnLimpiarFormServicio">üßΩ Limpiar</button>
                                </div>
                            </form>
                        </div>

                        <!-- Lista de servicios -->
                        <div class="mt-5">
                            <h3 style="font-size:1rem;margin-bottom:15px;">üìã Servicios Registrados</h3>
                            <div id="listaServicios" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px;">
                                <!-- Los servicios se mostrar√°n aqu√≠ -->
                            </div>
                            <p id="serviciosVaciosAdmin" class="text-muted small mt-5" style="display:none;">
                                No hay servicios registrados. Agrega tu primer servicio arriba.
                            </p>
                        </div>

                        <!-- Exportar / Importar Servicios -->
                        <div class="mt-5" style="background: #f0f4ff; padding: 15px; border-radius: 8px; border-left: 4px solid #4a90e2;">
                            <h3 style="font-size:1rem;margin-bottom:15px;">üíæ Exportar / Importar Servicios</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                                <button type="button" class="btn btn-primary btn-sm" id="btnDescargarServiciosJSON">
                                    üíæ Descargar servicios-iniciales.json
                                </button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btnImportarServiciosJSON">
                                    ‚¨Ü Importar servicios (JSON)
                                </button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btnImportarServiciosArchivo">
                                    üìÅ Importar desde archivo JSON
                                </button>
                            </div>
                            <textarea id="serviciosJsonArea" 
                                style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;resize:vertical;min-height:100px;display:none;font-family:monospace;font-size:0.85rem;"
                                placeholder="Pega aqu√≠ el JSON de servicios y vuelve a pulsar 'Importar servicios (JSON)'."></textarea>
                            
                            <!-- Seleccionar archivo servicios-iniciales.json -->
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                    <button type="button" id="btnSeleccionarArchivoServicios" class="btn btn-primary btn-sm" style="flex: 1;">
                                        üìÅ Seleccionar Archivo servicios-iniciales.json
                                    </button>
                                    <button type="button" id="btnActualizarArchivoServicios" class="btn btn-secondary btn-sm" style="flex: 1;">
                                        üîÑ Actualizar Archivo Ahora
                                    </button>
                                </div>
                                <div id="archivoServiciosStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; display: none;"></div>
                                <p class="text-muted small mt-5" style="margin-top: 10px; font-size: 11px;">
                                    <strong>üí° Nota:</strong> Selecciona el archivo servicios-iniciales.json para que se actualice autom√°ticamente cuando guardes servicios. Usa "Actualizar Archivo Ahora" para guardar los servicios actuales inmediatamente.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: An√°lisis -->
                    <div class="admin-tab-content" data-admin-tab-content="analisis" style="display:none;">
                        <h2><span class="icon">üìä</span> An√°lisis de Productos y Ventas</h2>
                        <p class="text-muted small">
                            Estad√≠sticas detalladas de productos m√°s vendidos, menos vendidos y an√°lisis de ventas.
                        </p>

                        <!-- Dashboard mejorado con gr√°ficos -->
                        <div class="mt-5">
                            <h3 style="font-size:1.1rem;margin-bottom:15px;">üìà Dashboard de Ventas</h3>
                            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;margin-bottom:30px;">
                                <div class="card" style="padding:20px;">
                                    <h4 style="font-size:0.95rem;margin-bottom:15px;">Ventas por D√≠a (√öltimos 7 d√≠as)</h4>
                                    <canvas id="graficoVentasDia" style="max-height:250px;"></canvas>
                                </div>
                                <div class="card" style="padding:20px;">
                                    <h4 style="font-size:0.95rem;margin-bottom:15px;">Ventas por Tipo</h4>
                                    <canvas id="graficoVentasTipo" style="max-height:250px;"></canvas>
                                </div>
                                <div class="card" style="padding:20px;">
                                    <h4 style="font-size:0.95rem;margin-bottom:15px;">Top 5 Categor√≠as</h4>
                                    <canvas id="graficoCategorias" style="max-height:250px;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- An√°lisis de productos -->
                        <div class="mt-5">
                            <h3 style="font-size:1.1rem;margin-bottom:15px;">üèÜ Productos M√°s Vendidos</h3>
                            <div class="table-wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Producto</th>
                                            <th>Categor√≠a</th>
                                            <th class="text-right">Unidades Vendidas</th>
                                            <th class="text-right">Total Vendido</th>
                                            <th class="text-right">Ganancia</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaProductosMasVendidos">
                                    </tbody>
                                </table>
                            </div>
                            <p id="productosMasVendidosVacio" class="text-muted small mt-5" style="display:none;">
                                A√∫n no hay ventas registradas.
                            </p>
                        </div>

                        <div class="mt-5">
                            <h3 style="font-size:1.1rem;margin-bottom:15px;">üìâ Productos Menos Vendidos</h3>
                            <div class="table-wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Producto</th>
                                            <th>Categor√≠a</th>
                                            <th class="text-right">Unidades Vendidas</th>
                                            <th class="text-right">Total Vendido</th>
                                            <th class="text-right">Stock Actual</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaProductosMenosVendidos">
                                    </tbody>
                                </table>
                            </div>
                            <p id="productosMenosVendidosVacio" class="text-muted small mt-5" style="display:none;">
                                A√∫n no hay ventas registradas.
                            </p>
                        </div>

                        <!-- Historial de movimientos de stock -->
                        <div class="mt-5">
                            <h3 style="font-size:1.1rem;margin-bottom:15px;">üì¶ Historial de Movimientos de Stock</h3>
                            <div style="display:flex;gap:8px;margin-bottom:15px;flex-wrap:wrap;">
                                <button type="button" class="btn btn-secondary btn-sm" id="btnFiltroMovimientosTodos">Todos</button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btnFiltroMovimientosEntrada">Entradas</button>
                                <button type="button" class="btn btn-secondary btn-sm" id="btnFiltroMovimientosSalida">Salidas</button>
                                <input type="text" id="filtroMovimientosBusqueda" placeholder="Buscar producto..." style="padding:6px 12px;border:1px solid #ddd;border-radius:4px;flex:1;min-width:200px;">
                            </div>
                            <div class="table-wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Fecha/Hora</th>
                                            <th>Tipo</th>
                                            <th>Producto</th>
                                            <th>Cantidad</th>
                                            <th>Stock Anterior</th>
                                            <th>Stock Nuevo</th>
                                            <th>Motivo</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaMovimientosStock">
                                    </tbody>
                                </table>
                            </div>
                            <p id="movimientosStockVacio" class="text-muted small mt-5" style="display:none;">
                                No hay movimientos de stock registrados.
                            </p>
                        </div>
                    </div>

                    <!-- TAB: Herramientas -->
                    <div class="admin-tab-content" data-admin-tab-content="herramientas" style="display:none;">
                        <h2><span class="icon">üß†</span> Herramientas de inventario</h2>

                        <div class="dashboard-strip">
                            <div class="dash-card">
                                <div class="dash-icon">üì¶</div>
                                <div>
                                    <div class="dash-label">Productos</div>
                                    <div class="dash-value" id="dashTotalProductos">0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">üìä</div>
                                <div>
                                    <div class="dash-label">Unidades totales</div>
                                    <div class="dash-value" id="dashTotalUnidades">0</div>
                                </div>
                            </div>
                            <div class="dash-card">
                                <div class="dash-icon">üí∞</div>
                                <div>
                                    <div class="dash-label">Valor inventario (costo)</div>
                                    <div class="dash-value" id="dashValorCosto">$0</div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-5">
                            <button type="button" class="btn btn-secondary btn-sm" id="btnExportarJSON">
                                ‚¨á Exportar productos (JSON)
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" id="btnDescargarJSON">
                                üíæ Descargar productos-iniciales.json + Actualizar HTML
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnSeleccionarHTML">
                                üìÅ Seleccionar archivos HTML (para actualizaci√≥n autom√°tica)
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnImportarJSON">
                                ‚¨Ü Importar productos (JSON)
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnImportarCSV">
                                ‚¨Ü Importar productos (CSV Excel)
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" id="btnBorrarTodo">
                                üóëÔ∏è Borrar todos los productos
                            </button>
                        </div>

                        <!-- Backup autom√°tico -->
                        <div class="mt-5 card" style="background:#e8f5e9;border:2px solid #4caf50;">
                            <h3 style="font-size:1rem;margin-bottom:15px;color:#2e7d32;">üíæ Backup Autom√°tico</h3>
                            <p class="text-muted small">
                                Configura respaldos autom√°ticos programados de todos tus datos.
                            </p>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:15px;">
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Frecuencia de Backup</label>
                                    <select id="backupFrecuencia" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                        <option value="diario">Diario</option>
                                        <option value="semanal">Semanal</option>
                                        <option value="mensual">Mensual</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:4px;font-size:0.85rem;font-weight:bold;">Hora del Backup</label>
                                    <input type="time" id="backupHora" value="02:00" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;">
                                </div>
                            </div>
                            <div style="margin-top:15px;">
                                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                    <input type="checkbox" id="backupActivo" style="width:18px;height:18px;">
                                    <span style="font-size:0.9rem;font-weight:bold;">Activar backup autom√°tico</span>
                                </label>
                            </div>
                            <div style="margin-top:15px;display:flex;gap:8px;flex-wrap:wrap;">
                                <button type="button" class="btn btn-primary btn-sm" id="btnGuardarConfigBackup">
                                    üíæ Guardar Configuraci√≥n
                                </button>
                                <button type="button" class="btn btn-success btn-sm" id="btnBackupManual">
                                    üì¶ Crear Backup Ahora
                                </button>
                                <button type="button" class="btn btn-warning btn-sm" id="btnImportarBackup">
                                    ‚¨ÜÔ∏è Importar Backup Completo
                                </button>
                            </div>
                            <input type="file" id="inputImportarBackup" accept=".json" style="display:none;">
                            <div id="backupEstado" style="margin-top:15px;padding:10px;background:#fff;border-radius:4px;font-size:0.85rem;">
                                <strong>Estado:</strong> <span id="backupEstadoTexto">No configurado</span>
                            </div>
                        </div>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnLogoutAdmin" style="margin-left:6px;">
                                üö™ Cerrar sesi√≥n
                            </button>
                        </div>
                        
                        <div class="mt-5" style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3;">
                            <strong>üíæ Actualizaci√≥n Autom√°tica del Archivo Local:</strong>
                            <p class="text-muted small mt-5" style="margin: 0 0 10px 0;">
                                Selecciona el archivo <code>productos-iniciales.json</code> de tu carpeta local una vez, y luego se actualizar√° autom√°ticamente cada vez que guardes un producto.
                            </p>
                            <button type="button" id="btnSeleccionarArchivo" class="btn btn-primary btn-sm" style="width: 100%;">
                                üìÅ Seleccionar Archivo productos-iniciales.json
                            </button>
                            <div id="archivoStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; display: none;"></div>
                            <p class="text-muted small mt-5" style="margin-top: 10px; font-size: 11px;">
                                <strong>Nota:</strong> La primera vez que guardes un producto, se te pedir√° que selecciones el archivo. Una vez seleccionado, se actualizar√° autom√°ticamente.
                            </p>
                        </div>
                        
                        <div class="mt-5" style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <strong>üåê Configuraci√≥n de GitHub (Opcional - Solo si no usas archivo local):</strong>
                            <p class="text-muted small mt-5" style="margin: 0 0 10px 0;">
                                Si prefieres actualizar directamente en GitHub en lugar del archivo local, configura tu repositorio aqu√≠.
                            </p>
                            <form id="githubConfigForm" style="margin-top: 10px;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Token de GitHub (Personal Access Token):</label>
                                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" 
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                    <small style="display: block; margin-top: 3px; color: #666;">
                                        Crea un token en: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)
                                    </small>
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Usuario/Organizaci√≥n:</label>
                                    <input type="text" id="githubOwner" placeholder="tu-usuario" 
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Nombre del repositorio:</label>
                                    <input type="text" id="githubRepo" placeholder="TabloncitoDigital_PRO_migrado.github.io" 
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Rama (Branch):</label>
                                    <input type="text" id="githubBranch" placeholder="main" value="main" 
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                </div>
                                <button type="submit" class="btn btn-secondary btn-sm" style="width: 100%;">
                                    üíæ Guardar Configuraci√≥n GitHub
                                </button>
                                <button type="button" id="btnTestGitHub" class="btn btn-secondary btn-sm mt-5" style="width: 100%;">
                                    üß™ Probar Conexi√≥n GitHub
                                </button>
                            </form>
                            <div id="githubConfigStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; display: none;"></div>
                        </div>

                        <textarea id="jsonArea" class="mt-5 small" style="width:100%;min-height:80px;display:none;"
                            placeholder="Aqu√≠ aparecer√° o podr√°s pegar el JSON de respaldo de productos"></textarea>

                        <input type="file" id="inputCSVProductos" accept=".csv" style="display:none;">

                        <p class="text-muted small mt-5">
                            Todo se guarda localmente en tu navegador con LocalStorage.  
                            Usa exportar para hacer copias de seguridad.
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </section>

</main>

<footer>
    &copy; <span id="anioFooter"></span> Tabloncito Digital ‚Ä¢ Panel de inventario.
</footer>

<script src="script.js"></script>
</body>
</html>
